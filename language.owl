#using owl.v4

.whitespace ' ' '\t' '\n'
.line-comment-token '//'

statements = statement*
statement = (constructor | method_call | assignment | routine_definition | rule_definition) (';')?

actions = action*
action = (method_call | assignment | await) (';')?

constructor = module_name '=' module_type '(' argument (',' argument)* ')'
module_type = identifier
argument = number | module_name

assignment = property_setter '=' expression

rule_definition = 'when' condition [ 'then' actions  ('else' actions)? 'end' ]

routine_definition = routine_name [ ':=' actions 'end' ]

await = 'await' condition

condition = expression comparison expression

expression = number | property_getter
comparison =
  '==' : equal
  '!=' : unequal

property_setter = module_name '.' property
property_getter = module_name '.' property
method_call = (module_name '.' method | routine_name)

module_name = identifier
routine_name = identifier
property = identifier
method = identifier